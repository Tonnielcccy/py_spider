# 数据分析实战

## 1、安居客租房信息分析

### 1.1 项目介绍

爬取安居客长沙市和武汉市的租房信息，进行数据清洗和可视化<br>

### 1.2 数据采集

spider文件夹中是项目的爬虫数据采集工作，它的主要功能如下：

| 模块             | 功能    |
|:---------------|:------|
| config.py      | 配置文件  |
| logger.py      | 日志记录  |
| parser.py      | 单页面解析 |
| requester.py   | 请求模块  |
| save.py        | 数据存储  |
| spider_main.py | 爬虫主程序 |
| text.py        | 测试程序  |

config模块中的随机UA能够避免反爬机制的触发，通过日志记载每一次爬取的成功与否，明细整个爬取过程。
在parser模块中使用BeautifulSoup解析HTML页面，提取出我们需要的数据。得到标题、价格、户型、小区名、位置、标签。
在save模块中，保存至output中的cs_anjuke_rentals.csv和wh_anjuke_rentals.csv中。

### 1.3 数据处理与描述

processing文件夹中是对数据进行初步的处理工作，它的主要功能如下：

| 模块            | 功能       |
|:--------------|:---------|
| data_clean.py | 数据清洗     |
| data_des.py   | 数据描述     |
| loc_change.py | 模糊位置精准化  |
| loc_api.py    | 地理位置编码   |
| api_text.py   | 地理位置编码测试 |

在数据处理中，首先将初始数据进行去重、去缺失值、去异常值得到清洗后的数据output/cs_cleaned.csv和output/wh_cleaned.csv。
再对数据进行初步的描述统计，得出以下结果：

**长沙市描述统计：**

| 指标    | 租金数值         | 面积数值        |
|:------|:-------------|:------------|
| count | 1682.000000  | 1682.000000 |
| mean  | 2030.202140  | 74.857420   |
| std   | 1499.506245  | 44.695369   |
| min   | 300.000000   | 10.000000   |
| 25%   | 1350.000000  | 41.015000   |
| 50%   | 1700.000000  | 64.305000   |
| 75%   | 2300.000000  | 97.000000   |
| max   | 20000.000000 | 700.000000  |

**武汉市描述统计：**

| 指标    | 租金数值         | 面积数值        |
|:------|:-------------|:------------|
| count | 1212.000000  | 1212.000000 |
| mean  | 1406.923267  | 57.894802   |
| std   | 932.487142   | 34.833831   |
| min   | 300.000000   | 8.500000    |
| 25%   | 620.000000   | 25.000000   |
| 50%   | 1200.000000  | 51.100000   |
| 75%   | 1800.000000  | 86.275000   |
| max   | 12000.000000 | 283.200000  |

**地理位置编码**<br>
在进行简单的描述性统计和可视化之后，为了后续的分析，需要将原来数据的位置信息置换为经纬度编码信息。
总体的位置编码过程依靠高德地图的开发者平台的Web服务API调用实现，通过API的调用将原来的具体位置信息“长沙市芙蓉区五一广场韭菜园路97号”变为经纬度信息“112.988704,28.193534”。
但是在整体的进行之前，还要将原来的非标准位置转化为高德地图API能够理解的标准化位置信息，这一步骤通过loc_change.py进行。

### 1.4 可视化

**长沙市可视化**

以租金为X轴，房源数量为Y轴绘制直方图，得到如下：
![长沙市租金分布直方图.png](anjuke/output/长沙市租金分布直方图.png)

再绘制长沙市的户型租金箱线图：
![长沙市户型租金箱线图.png](anjuke/output/长沙市户型租金箱线图.png)

对标签绘制词云图：
![长沙市房源标签词云图](anjuke/output/长沙市房源标签词云图.png)

户型饼图：
![长沙市户型饼图.png](anjuke/output/长沙市户型饼图.png)

面积租金散点图
![长沙市面积租金散点图.png](anjuke/output/长沙市面积租金散点图.png)

**武汉市可视化**

以租金为X轴，房源数量为Y轴绘制直方图，得到如下：
![武汉市租金分布直方图.png](anjuke/output/武汉市租金分布直方图.png)

绘制武汉市的户型租金箱线图：
![武汉市户型租金箱线图.png](anjuke/output/武汉市户型租金箱线图.png)

对标签绘制词云图：
![武汉市房源标签词云图](anjuke/output/武汉市房源标签词云图.png)

户型饼图：
![武汉市户型饼图.png](anjuke/output/武汉市户型饼图.png)

面积租金散点图：
![武汉市面积租金散点图.png](anjuke/output/武汉市面积租金散点图.png)

结合两者词云图对比分析来开，交通便利似乎是租房的一大重要条件。

**热力图**<br>
使用高德地图的JS API功能，对清洗和进行地理编码后的进行热力图的绘制。 对房源位置相同地点的租金取平均值然后绘制热力图。

长沙市热力图：
![长沙市热力图](anjuke/output/长沙市热力图.png)

武汉市热力图：
![武汉市热力图](anjuke/output/武汉市热力图.png)

### 1.5 KMeans聚类

对租金和面积进行KMeans聚类，使用绘制肘部法则来确定聚类数。

长沙市肘部法：
![肘部法则.png](anjuke/output/长沙市肘部法.png)
因此确定聚类数目为4

长沙市肘部法：
![肘部法则.png](anjuke/output/武汉市肘部法.png)
因此确定聚类数目为4

对聚类结果进行可视化：
![聚类结果.png](anjuke/output/长沙市KMeans聚类.png)

![聚类结果.png](anjuke/output/武汉市KMeans聚类.png)


## 2、Opta英超球员数据分析

### 2.1 项目介绍

爬取Opta英超球员数据，进行数据清洗和可视化,最后使用PCA。
希望能够通过球员在场上的的表现分析不同球员位置差异。

### 2.2 数据采集
player_data_from_Opta.ipynb中，进行数据采集和简单的数据清洗，使用BeautifulSoup解析HTML页面，提取出我们需要的数据。得到以下内容：
![img.png](opta/img/figure_9.png)
在爬取过程中使用分阶段爬取，得到players_attack_data.xlsx、players_chanceCreation_data.xlsx、players_defending_data.xlsx、players_passing_data.xlsx和players_possession_data.xlsx
然后将数据进行合并得到players_data.xlsx，再进行简单清理后保存为cleaned_players_data.xlsx

### 2.3 数据处理与描述

来自俱乐部占比：
![img.png](opta/img/figure_10.png)

球员位置占比（1：前锋 2：中场 3：后卫）：
![img.png](opta/img/figure_11.png)

### 2.4 PCA、KMeans聚类和决策树
对数据进行PCA降维，使用KMeans聚类算法进行聚类，最后使用决策树进行分类。

首先通过碎石图判断PCA主成分数量，确定主成分为4。
![img.png](opta/img/figure_1.png)

PCA降维之后，绘制每个成分的贡献值图：
![img.png](opta/img/figure_2.png)

同时绘制每个变量对主成分贡献值的热力图：
![img.png](opta/img/figure_3.png)

对4个成分命名为：进攻能力、防守能力、助攻能力、进球效率

kMeans聚类，首先使用肘部法则确定聚类数目为3：
![img.png](opta/img/figure_4.png)
计算得到聚类轮廓系数为0.31

然后绘制聚类结果，红叉位置为中心值：
![img.png](opta/img/figure_5.png)

判断最大深度，使用交叉验证法：
![img.png](opta/img/figure_8.png)

最后使用决策树进行分类，得到如下结果：
![img.png](opta/img/figure_7.png)

并且绘制混淆矩阵：
![img.png](opta/img/figure_6.png)
看出聚类效果较好，判断错误的较少。

同时训练模型准确率为0.81，测试集准确率为0.79，模型效果较好。
